<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Sign Up</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta
            name="google-signin-client_id"
            content="1079952766457-jopvn7i6ij00vuvg1jmfchboufcb3a1u.apps.googleusercontent.com"
        />
        <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <link
            rel="stylesheet"
            type="text/css"
            href="static/css/test_login.css"
        />
        <link
            rel="stylesheet"
            href="../static/intel/build/css/intlTelInput.css"
        />

        <link
            href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css"
            rel="stylesheet"
        />
        <script src="https://apis.google.com/js/api:client.js"></script>

        <style type="text/css">
            .iti {
                width: 100% !important;
            }

            #customBtn {
                display: inline-block;
                background: white;
                color: #444;
                width: 245px;
                border: thin solid #888;
                border-radius: 99px;
                margin: auto;
                display: block;
                position: absolute;
                margin-top: 44px;
                text-align: left;
            }

            #customBtn:hover {
                cursor: pointer;
            }

            #customBtnlogin {
                display: inline-block;
                background: white;
                color: #444;
                width: 245px;
                border: thin solid #888;
                border-radius: 99px;
                margin: auto;
                display: block;
                position: absolute;
                margin-top: 44px;
                text-align: left;
            }

            #customBtnlogin:hover {
                cursor: pointer;
            }

            span.label {
                font-family: serif;
                font-weight: normal;
            }

            span.icon {
                background: url(https://developers.google.com/identity/images/g-logo.png)
                    transparent 5px 50% no-repeat;
                display: inline-block;
                vertical-align: middle;
                background-size: cover;
                width: 30px;
                height: 30px;
                margin-left: 7px;
            }

            span.buttonText {
                font-size: 17px;
                font-weight: bold;
                font-family: "Roboto", sans-serif;
                text-align: left;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="login-div-1">
                <div class="login-div-2">
                    <img
                        src="static/img/login-logo.png"
                        class="img-fluid login-logo-1"
                    />
                </div>
                <div class="login-div-3">
                    <p class="text-center font-weight-bold h5 pb-3">Sign Up</p>
                    {% if loginerror != "NULL" %}
                    <div class="form-group">
                        <div
                            class="alert alert-danger alert-dismissible fade show"
                            role="alert"
                        >
                            <span class="badge badge-pill badge-danger"
                                >Alert</span
                            >
                            {{ loginerror }}
                            <button
                                type="button"
                                class="close"
                                data-dismiss="alert"
                                aria-label="Close"
                            >
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    </div>
                    {% endif %} {% if message != "" %}
                    <div class="form-group">
                        <div
                            class="alert alert-success alert-dismissible fade show"
                            role="alert"
                        >
                            <span class="badge badge-pill badge-success"
                                >Success</span
                            >
                            {{ message }}
                            <button
                                type="button"
                                class="close"
                                data-dismiss="alert"
                                aria-label="Close"
                            >
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    </div>
                    {% endif %}

                    <form
                        class="login-form-1"
                        id="submitForm"
                        onsubmit="return paymentmethod()"
                        enctype="multipart/form-data"
                        oninput='checkpassword.setCustomValidity(checkpassword.value != password.value ? "Passwords do not match." : "")'
                    >
                        <input
                            type="text"
                            id="plantype"
                            name="plantype"
                            value="{{ plantype }}"
                            required
                            style="display: none"
                        />

                        <div class="form-group">
                            <input
                                type="text"
                                class="form-control"
                                id="username"
                                name="username"
                                aria-describedby="UserName"
                                placeholder="Enter User Name"
                                value=""
                                required
                                minlength="5"
                                maxlength="24"
                            />
                        </div>

                        <div class="form-group">
                            <input
                                type="email"
                                class="form-control"
                                id="email"
                                name="email"
                                aria-describedby="email"
                                placeholder="Enter email"
                                {%
                                if
                                loginemail
                                !=""
                                %}
                                value="{{ loginemail }}"
                                {%
                                endif
                                %}
                                maxlength="124"
                                required
                            />
                        </div>
                        <div class="form-group">
                            <input
                                type="text"
                                class="form-control"
                                name="phone"
                                aria-describedby="Phone"
                                id="mobilenumber"
                                {%
                                if
                                loginphoneno
                                !=""
                                %}
                                value="{{ loginphoneno }}"
                                {%
                                endif
                                %}
                                value="+44"
                                required
                                max="999999999999999"
                            />
                        </div>

                        <div class="form-group">
                            <input
                                type="password"
                                class="form-control"
                                id="password"
                                name="password"
                                placeholder="Password"
                                pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*?[~`!@#$%\^&*()\-_=+[\]{};:\x27.,\x22\\|/?><]).{8,}"
                                title="Must contain at least one number and one uppercase and lowercase letter and special character and at least 8 or more characters"
                                required
                            /><span
                                ><i
                                    class="fa fa-eye"
                                    id="togglePassword"
                                    onclick=""
                                    style="
                                        float: right;
                                        margin-top: -30px;
                                        margin-left: -40px;
                                        position: relative;
                                        z-index: 1;
                                        cursor: pointer;
                                    "
                                ></i
                            ></span>
                        </div>

                        <div class="form-group">
                            <input
                                type="password"
                                class="form-control"
                                id="checkpassword"
                                name="checkpassword"
                                pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*?[~`!@#$%\^&*()\-_=+[\]{};:\x27.,\x22\\|/?><]).{8,}"
                                title="Must contain at least one number and one uppercase and lowercase letter and special character and at least 8 or more characters"
                                placeholder="Repeat Password"
                                required
                            />
                        </div>

                        <div class="form-row">
                            <div class="form-check">
                                <input
                                    type="checkbox"
                                    class="form-check-input"
                                    id="exampleCheck1"
                                    required
                                />
                                <label
                                    class="form-check-label"
                                    for="exampleCheck1"
                                    >I agree to the Voicescity User Agreement
                                    and Privacy Policy.
                                </label>
                            </div>

                            <input
                                type="hidden"
                                name="plantype"
                                value="{{plantype}}"
                            />
                            <button type="submit" class="Login-Form-Btn-1 mt-3">
                                Join Voicescity
                            </button>
                        </div>
                    </form>

                    <hr style="border-top: 1px solid #be9e65" />

                    <p class="text-center">
                        Already have an account? <a href="/login"> Log in</a>
                    </p>
                    <div style="text-align: center">
                        <a
                            href="/resend_verification"
                            class="forget-password text-center"
                        >
                            Didn't receive verification email?</a
                        >
                    </div>
                    <div class="g-signin2" data-onsuccess="onSignIn"></div>

                    <div class="row">
                        <div class="col-sm-6">
                            <img
                                src="static/img/apptore.png"
                                class="img-fluid app-store-img-1"
                            />
                        </div>
                        <div class="col-sm-6">
                            <img
                                src="static/img/playstore.png"
                                class="img-fluid"
                            />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script src="../static/intel/build/js/intlTelInput-jquery.min.js"></script>
    <script src="../static/intel/build/js/intlTelInput.min.js"></script>
    <script src="https://checkout.stripe.com/checkout.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.js"></script> -->
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>
    <script>
        function paymentmethod() {
            var plantype = document.getElementById("plantype").value;
            // hide the bootstrap alert
            var price = 0;
            if (plantype == "premium") {
                price = 299 * 100;
            } else if (plantype == "silver") {
                price = 199 * 100;
            }

            // console.log($("#submitForm").valid());
            var password = document.getElementById("password").value;
            var email = document.getElementById("email").value;
            var mobilenumber = document.getElementById("mobilenumber").value;
            var username = document.getElementById("username").value;
            fetch("/email-check", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    email: email,
                }),
            }).then(function (response) {
                if (!response.ok) {
                    window.location.href = "/worksignup?plantype=" + plantype;
                    return true;
                } else {
                    if (plantype == "standard") {
                        fetch("/worksignup", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                amount: price,
                                username: username,
                                password: password,
                                email: email,
                                phone: mobilenumber,
                                plantype: plantype,
                                description: plantype,
                            }),
                        }).then(function (response) {
                            console.log(response);
                            if (response.ok) {
                                alert(
                                    "Please check your email to activate your account."
                                );
                                window.location.href = "/login";
                                return "true";
                            }
                        });
                    } else {
                        var handler = StripeCheckout.configure({
                            key: "{{ key }}",
                            image: "../static/img/logo1.png",
                            locale: "auto",

                            token: function (token) {
                                fetch("/worksignup", {
                                    method: "POST",
                                    headers: {
                                        "Content-Type": "application/json",
                                    },
                                    body: JSON.stringify({
                                        token: token.id,
                                        amount: price,
                                        username: username,
                                        password: password,
                                        email: email,
                                        phone: mobilenumber,
                                        plantype: plantype,
                                        description: plantype,
                                    }),
                                })
                                    .then(function (jsonResponse) {
                                        if (jsonResponse.ok) {
                                            // update the alert message
                                            alert(
                                                "Payment method successfuly updated.\nPlease check your email to activate your account."
                                            );
                                        } else {
                                            alert("Your card was declined");
                                        }
                                        window.location.href = "/login";
                                    })
                                    .catch(function (err) {
                                        // update the alert message
                                        alert(err);
                                    });
                            },
                        });

                        handler.open({
                            name: "Voices City",
                            description: "Payment Plan",
                            amount: price,
                            currency: "USD",
                            country: "GB",
                        });
                    }
                }
            });

            return false;
        }
    </script>
    <script type="text/javascript">
        var input = document.querySelector("#mobilenumber");
        var countrycode = "ae";
        var iti = window.intlTelInput(input, {
            separateDialCode: false,

            placeholderNumberType: "MOBILE",

            initialCountry: countrycode,
            nationalMode: false,
            customPlaceholder: function (
                selectedCountryPlaceholder,
                selectedCountryData
            ) {
                var placeholder = selectedCountryPlaceholder;

                return placeholder;
            },
            utilsScript: "../static/intel/build/js/utils.js",
        });
    </script>

    <script>
        const togglePassword = document.querySelector("#togglePassword");
        const password = document.querySelector("#password");
        togglePassword.addEventListener("click", function (e) {
            // toggle the type attribute
            const type =
                password.getAttribute("type") === "password"
                    ? "text"
                    : "password";
            password.setAttribute("type", type);
            // toggle the eye slash icon
            this.classList.toggle("fa-eye-slash");
        });
    </script>

    <script>
        gapi.load("auth2", function () {
            gapi.auth2.init();
        });
        function onSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            console.log("ID: " + profile.getId()); // Do not send to your backend! Use an ID token instead.
            console.log("Name: " + profile.getName());
            console.log("Image URL: " + profile.getImageUrl());
            console.log("Email: " + profile.getEmail()); // This is null if the 'email' scope is not present.
        }

        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                console.log("User signed out.");
            });
        }
    </script>
</html>
